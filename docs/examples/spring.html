<!doctype html>
<notebook theme="air">
  <title>Spring</title>
  <script id="0" type="text/markdown">
    # Spring

    ${quote}
  </script>
  <script id="50" type="application/vnd.observable.javascript">
    viewof replay = Inputs.button("Replay")
  </script>
  <script id="8" type="application/vnd.observable.javascript" pinned="">
    {
      replay;

      const width = 600,
        height = 200,
        x = (d) => d.r * Math.sin(d.angle),
        y = (d) => d.r * Math.cos(d.angle),
        pendulum = { angle: Math.PI / 4, aVelocity: 0, r: 150, damping: 0.995 };

      function clear(app) {
        app.append(cm.clear, { fill: cm.rgb(255) });
      }

      function draw(app) {
        const group = app
          .append(cm.group, { x: width / 2, y: 0 })
          .datum(pendulum)
          .process(cm.each, update);

        group.append(cm.link, { x: 0, y: 0, x1: x, y1: y });
        group.append(cm.circle, {
          x,
          y,
          r: 20,
          fill: cm.rgb(175),
          stroke: cm.rgb(0)
        });
      }

      function dispose(app) {
        invalidation.then(() => app.dispose());
      }

      return cm
        .app({ width, height })
        .on("update", clear)
        .on("update", draw)
        .call(dispose)
        .call(frame)
        .start()
        .node();
    }
  </script>
  <script id="46" type="application/vnd.observable.javascript" pinned="">
    function update(d) {
      const aAcceleration = -1 * (0.4 / d.r) * Math.sin(d.angle);
      d.aVelocity += aAcceleration;
      d.aVelocity *= d.damping;
      d.angle += d.aVelocity;
    }
  </script>
  <script id="24" type="application/vnd.observable.javascript" pinned="">
    function frame(app) {
      app.node().style.border = "solid #000 1px";
    }
  </script>
  <script id="5" type="application/vnd.observable.javascript" pinned="">
    cm = require("@charming-art/charming@0.0.6")
  </script>
  <script id="64" type="application/vnd.observable.javascript" pinned="">
    import { quote } from "@pearmini/charming-shared"
  </script>
</notebook>
